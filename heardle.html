<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		* {
			font-family: sans-serif;
		}

		body {
			margin: 0px;
		}

		h1 {
			text-align: left;
		}

		#toggle_btn {
			font-size: 50pt;
			cursor: pointer;
			color: grey;
		}

		.container {
			width: 30%;
			height: 100vh;
			margin: auto;
			min-width: 300px;
			text-align: center;
		}

		.prev_guess {
			display: block;
			padding: 10px;
			width: calc(100% - 22px);
			border: 1px solid grey;
			margin-bottom: 10px;
			border-radius: 7px;
			font-weight: bold;
		}

		#guess_input {
			width: calc(100% - 24px);
			padding: 10px;
			border: 2px solid black;
			z-index: 100;
			position: relative;
		}

		.grey_out {
			color: lightgrey;
		}

		.controls {
			vertical-align: auto;
		}

		#song_progress {
			display: block;
			width: 100%;
			padding: 10px;
			transition: all 0.5s;
		}

		#autocomplete {
			box-sizing: border-box;
			margin: 40px 0px;
		}

		#autocomp_items {
			background-color: white;
			border: 2px solid black;
			width: calc(30% - 4px);
			min-width: 296px;
			position: absolute;
			border-radius: 5px;
			margin-top: -5px;
			padding-top: 5px;
			z-index: 10;
			visibility: hidden;
			max-height: 200px;
			overflow-y: auto;
		}

		.sugg_item {
			padding: 5px;
			cursor: pointer;
		}

		.sugg_item:hover {
			color: white;
			background-color: blue;
		}
	</style>
	<title>heardle</title>
</head>

<body>
	<div class="container">
		<h1>heardle</h1>
		<div id="guess_container"></div>
		<div class="controls">
			<span id="toggle_btn" type="play">▶</span>
			<progress id="song_progress" value="0" max="100"></progress>
		</div>
		<!-- <button id="reset">Reset</button> -->

	</div>

	<iframe hidden="true" allow="autoplay" id="sc-widget" src="" scrolling="no" frameborder="no"></iframe>

	<script src="https://w.soundcloud.com/player/api.js"></script>
	<script>
		var n_guesses = 6;
		var guess_secs = [1, 2, 5, 9, 16, 30];
		var current_guess = 0;

		var song_list = [{ url: "https://soundcloud.com/thexxofficial/intro", answer: "The xx - Intro" }, { url: "https://soundcloud.com/dualipa/levitating", answer: "Dua Lipa - Levitating" }, { url: "https://soundcloud.com/adelemusic/set-fire-to-the-rain-1", answer: "Adele - Set Fire to the Rain" }, { url: "https://soundcloud.com/coldplay/the-scientist", answer: "Coldplay - The Scientist" }, { url: "https://soundcloud.com/bennyblanco/eastside", answer: "Benny Blanco - Eastside (feat. Halsey and Khalid)" }, { url: "https://soundcloud.com/nirvana/smells-like-teen-spirit-1", answer: "Nirvana - Smells Like Teen Spirit" }, { url: "https://soundcloud.com/amalaofficial/streets", answer: "Doja cat - Streets" }, { url: "https://soundcloud.com/beyonce/halo", answer: "Beyoncé - Halo" }, { url: "https://soundcloud.com/fleetwoodmacofficial/dreams", answer: "Fleetwood Mac - Dreams" }, { url: "https://soundcloud.com/kanyewest/black-skinhead", answer: "Kanye West - Black Skinhead" }, { url: "https://soundcloud.com/arianagrande/7-rings", answer: "Ariana Grande - 7 rings" }, { url: "https://soundcloud.com/kingsofleon/use-somebody", answer: "Kings of Leon - Use Somebody" }, { url: "https://soundcloud.com/outkast-music/ms-jackson", answer: "Outkast - Ms. Jackson" }, { url: "https://soundcloud.com/secret-service-862007284/thats-what-i-want", answer: "Lil Nas X - That's What I Want" }, { url: "https://soundcloud.com/rihanna/rude-boy", answer: "Rihanna - Rude Boy" }, { url: "https://soundcloud.com/whitneyhouston/i-wanna-dance-with-somebody-1", answer: "Whitney Houston - I Wanna Dance With Somebody (Who Loves Me)" }, { url: "https://soundcloud.com/wheatus-official/teenage-dirtbag-1", answer: "Wheatus - Teenage Dirtbag" }, { url: "https://soundcloud.com/lizzomusic/truth-hurts", answer: "Lizzo - Truth Hurts" }, { url: "https://soundcloud.com/blurofficial/song-2", answer: "Blur - Song 2" }, { url: "https://soundcloud.com/childish-gambino/redbone", answer: "Childish Gambino - Redbone" }, { url: "https://soundcloud.com/madonna/like-a-virgin-album-version", answer: "Madonna - Like a Virgin" }, { url: "https://soundcloud.com/daftpunkofficialmusic/harder-better-faster", answer: "Daft Punk - Harder, Better, Faster, Stronger" }, { url: "https://soundcloud.com/al-green-official/lets-stay-together-5", answer: "Al Green - Let's Stay Together" }, { url: "https://soundcloud.com/atlanticrecords/locked-out-of-heaven", answer: "Bruno Mars - Locked Out of Heaven" }, { url: "https://soundcloud.com/wizkid-official/track-11", answer: "Wizkid - Essence (feat. Tems)" }, { url: "https://soundcloud.com/destinys-child-official/independent-women-pt-i-3", answer: "Destiny's Child - Independent Women, Pt. 1" }, { url: "https://soundcloud.com/thekidlaroi/stay", answer: "The Kid LAROI. - Stay (feat. Justin Bieber)" }, { url: "https://soundcloud.com/linkin_park/numb", answer: "Linkin Park - Numb" }, { url: "https://soundcloud.com/markronson/valerie-version-revisited", answer: "Mark Ronson - Valerie (feat. Amy Winehouse)" }, { url: "https://soundcloud.com/dj-jazzy-jeff-the-fresh-prince/summertime-single-edit-1", answer: "DJ Jazzy Jeff & The Fresh Prince - Summertime" }, { url: "https://soundcloud.com/dollyparton/jolene-11", answer: "Dolly Parton - Jolene" }, { url: "https://soundcloud.com/foofighters/learn-to-fly", answer: "Foo Fighters - Learn To Fly" }, { url: "https://soundcloud.com/missyelliott/get-ur-freak-on", answer: "Missy Elliott - Get Your Freak On" }, { url: "https://soundcloud.com/aceofbaseofficial/all-that-she-wants", answer: "Ace of Base - All That She Wants" }, { url: "https://soundcloud.com/iamcardib/up-1", answer: "Cardi B - Up" }, { url: "https://soundcloud.com/rick-astley-official/never-gonna-give-you-up-7", answer: "Rick Astley - Never Gonna Give You Up" }, { url: "https://soundcloud.com/miauk/paper-planes", answer: "M.I.A. - Paper Planes" }, { url: "https://soundcloud.com/daryl-hall-john-oates/you-make-my-dreams-remastered", answer: "Daryl Hall and John Oates - You Make My Dreams (Come True)" }, { url: "https://soundcloud.com/brunomars/bruno-mars-anderson-paak-silk", answer: "Silk Sonic - Leave The Door Open" }, { url: "https://soundcloud.com/spice-girls-official/wannabe-radio-edit", answer: "Spice Girls - Wannabe" }, { url: "https://soundcloud.com/ledzeppelin/immigrant-song-1", answer: "Led Zeppelin - Immigrant Song" }, { url: "https://soundcloud.com/fugees/ready-or-not-1", answer: "Fugees - Ready Or Not" }, { url: "https://soundcloud.com/abba-official/dancing-queen-1", answer: "Abba - Dancing Queen" }, { url: "https://soundcloud.com/luthervandrossmusic/never-too-much-2", answer: "Luther Vandross - Never Too Much" }, { url: "https://soundcloud.com/johnlegend/ordinary-people-1", answer: "John Legend - Ordinary People" }, { url: "https://soundcloud.com/red-hot-chili-peppers-official/californication", answer: "Red Hot Chili Peppers - Californication" }, { url: "https://soundcloud.com/originalkoffee/toast", answer: "Koffee - Toast" }, { url: "https://soundcloud.com/official-p-nk/get-the-party-started", answer: "Pink - Get The Party Started" }, { url: "https://soundcloud.com/camilacabello/my-oh-my-feat-dababy", answer: "Camila Cabello - My Oh My (feat. DaBaby)" }, { url: "https://soundcloud.com/oasisofficial/wonderwall-2", answer: "Oasis - Wonderwall" }, { url: "https://soundcloud.com/cheryl-lynn-official/got-to-be-real-single-version", answer: "Cheryl Lynn - Got To Be Real" }, { url: "https://soundcloud.com/fatboyslim/09-praise-you", answer: "Fatboy Slim - Praise You" }, { url: "https://soundcloud.com/annie-lennox-official/walking-on-broken-glass", answer: "Annie Lennox - Walking On Broken Glass" }, { url: "https://soundcloud.com/arcticmonkeys/i-bet-you-look-good-on-the", answer: "Arctic Monkeys - I Bet You Look Good On The Dancefloor" }, { url: "https://soundcloud.com/snoopdogg/young-wild-free-feat-bruno-1", answer: "Snoop Dogg & Wiz Khalifa - Young, Wild & Free (ft. Bruno Mars)" }, { url: "https://soundcloud.com/harrystyles/adore-you", answer: "Harry Styles - Adore You" }, { url: "https://soundcloud.com/shakira/whenever-wherever", answer: "Shakira - Whenever, Wherever" }, { url: "https://soundcloud.com/markmorrisonmusic/return-of-the-mack-c-j-street", answer: "Mark Morrison - Return Of The Mack" }, { url: "https://soundcloud.com/lauryn-hill-official/ex-factor", answer: "Lauryn Hill - Ex-Factor" }, { url: "https://soundcloud.com/rolling-stones-official/i-cant-get-no-satisfaction-3", answer: "Rolling Stones - (I Can't Get No) Satisfaction" }, { url: "https://soundcloud.com/amerie-official/1-thing", answer: "Amerie - 1 Thing" }, { url: "https://soundcloud.com/joanjettandtheblackhearts/i-love-rock-n-roll", answer: "Joan Jett & The Blackhearts - I Love Rock 'n' Roll" }];
		var current_song;

		function init_game() {
			current_guess = 0;
			current_song = song_list[Math.floor(Math.random() * song_list.length)];

			document.getElementById("sc-widget").src = "https://w.soundcloud.com/player/?url=" + current_song.url;
			var widgetIframe = document.getElementById('sc-widget');
			var widget = SC.Widget(widgetIframe);

			widget.bind(SC.Widget.Events.READY, function () {
				console.log("SC ready");
				document.getElementById("toggle_btn").style.color = "black";
			});

			// old_time introduced since SC.Widget.Events.PLAY fires twice. Bar no longer skips around between 2 streams.
			var old_time = 0;
			document.getElementById('toggle_btn').addEventListener('click', function (e) {
				if (document.getElementById("toggle_btn").getAttribute("type") == "play") {
					//plays from the start each time
					widget.seekTo(0);
					old_time = 0;

					widget.play();
					document.getElementById("toggle_btn").setAttribute("type", "pause");

				}
				// cannot have pause atm - will have to let song play through!
				else {
					/*
					widget.pause();
					document.getElementById("toggle_btn").setAttribute("type", "play");
					clearInterval(loop);
					*/
				}
			});

			widget.bind(SC.Widget.Events.PLAY, function () {
				console.log("SC playing");
				document.getElementById("toggle_btn").style.color = "grey";

				var milliseconds = 0;
				var loop = setInterval(() => {
					milliseconds += 100;
					if (milliseconds <= old_time) {
						return;
					}

					console.log(milliseconds);
					old_time = milliseconds;
					document.getElementById("song_progress").value = (milliseconds / 300);

					if (milliseconds == guess_secs[current_guess] * 1000) {
						console.log("time has reached " + milliseconds.toString());
						widget.pause();
						clearInterval(loop);
					}

				}, 100);

				widget.bind(SC.Widget.Events.PAUSE, function () {
					console.log("SC paused");
					document.getElementById("toggle_btn").style.color = "black";
					document.getElementById("toggle_btn").setAttribute("type", "play");
					clearInterval(loop);
				});
			});

			draw_app();
		}

		document.addEventListener("DOMContentLoaded", init_game);

		function draw_app() {
			var app = "";
			for (var i = 0; i < n_guesses; i++) {
				app += "<div class='prev_guess grey_out' id='guess" + i.toString() + "'>" + (i + 1).toString() + "</div>";
			}

			app += "<div id='autocomplete'><input type='text' id='guess_input'></input><div id='autocomp_items'></div></div>";
			document.getElementById("guess_container").innerHTML = app;

			document.getElementById("guess_input").addEventListener("input", (e) => {
				if (e.target.value == "") {
					document.getElementById("autocomp_items").style.visibility = "hidden";
					return;
				}
				else {
					document.getElementById("autocomp_items").style.visibility = "visible";
					var suggestions_html = "";
					for (var i = 0; i < song_list.length; i++) {
						if (song_list[i].answer.toUpperCase().includes(e.target.value.toUpperCase())) {
							suggestions_html += "<div class='sugg_item'>" + song_list[i].answer + "</div>";
						}
					}

					document.getElementById("autocomp_items").innerHTML = suggestions_html != "" ? suggestions_html : "No results found";

					var items = document.getElementsByClassName("sugg_item");
					for (var i = 0; i < items.length; i++) {
						items[i].addEventListener("click", (e2) => {
							if (e2.target.outerText == current_song.answer) {
								alert("!!");
							}
							else {
								document.getElementById("guess" + current_guess.toString()).innerHTML = e2.target.outerText;
								document.getElementById("guess" + current_guess.toString()).classList.remove("grey_out");
								current_guess++;
							}
							document.getElementById("autocomp_items").style.visibility = "hidden";
							e.target.value = "";
						});
					}
				}
			});
		}

		document.getElementById("reset").addEventListener("click", (e) => {
			init_game();
		});

	</script>
</body>

</html>